(function(){var e=window;e.controls=e.controls||{};e.controls.$AutoComplete=function(){function s(i){e=$(i.id);t=$(i.compsId);n=i.dataSrc;r=i.comparablesStore;e.wrap('<div class="autocomplete"></div>')}function o(){e.bind("focus.autocomplete blur.autocomplete",u);e.bind("keyup.autocomplete",a);e.bind("keydown.autocomplete",f);$(window).bind("unload beforeunload",function(){e.unbind(".autocomplete")})}function u(t){if(t.type=="focus"){e.addClass("focus")}else{e.removeClass("focus");setTimeout(c,250)}}function a(t){var r=e.val();if(r==""){n.clearPendingQueries();c()}else if(t.keyCode==13){n.clearPendingQueries();var i=$("#"+e.attr("id")+"_ul li.active");if(i.length==1){p(i.text())}c()}else if(t.keyCode==8||t.keyCode>=65&&t.keyCode<=90){n.findMatches(r).then(l)}}function f(t){var n=e.val();if(t.keyCode==40){var r=$("#"+e.attr("id")+"_ul li.active");var i=$("#"+e.attr("id")+"_ul li").first();if(r.length==1){r.removeClass("active");var s=r.next();if(s.length==1){i=s}}i.addClass("active").focus()}else if(t.keyCode==38){var r=$("#"+e.attr("id")+"_ul li.active");var i=$("#"+e.attr("id")+"_ul li").last();if(r.length==1){r.removeClass("active");var o=r.prev();if(o.length==1){i=o}}i.addClass("active").focus()}}function l(e){var t=e.status==="success"?e.result:[];c(e.result)}function c(t){$("#"+e.attr("id")+"_ul").unbind(".menuevents").remove();if(t&&t.length>0){var n=$("<ul id="+e.attr("id")+"_ul></ul>").css({"min-width":e.outerWidth()-2}).bind("mouseover.menuevents mouseout.menuevents",h);$.each(t,function(){n.append($(["<li>",this,"</li>"].join("")).bind("click",function(){p($(this).text())}))});e.parent().append(n)}}function h(t){$("#"+e.attr("id")+"_ul li.active").removeClass("active");$(t.srcElement).addClass("active")}function p(i){e.val(i);c();var s=i.substring(i.lastIndexOf("(")+1,i.lastIndexOf(")"));r.get(s).then(function(e){var r=$("<div class='list'></div>");if(e.length>0){r.append("<h2 class='related'>Related companies for "+s+" :</h2>");$.each(e,function(){if(this.recommendation!==s){r.append($("<div class='comp'>"+"<span class='name'>"+n.getCompanyName(this.recommendation)+"</span>"+"<span class='ticker'>("+this.recommendation+")</span>"+"</div>"))}})}else{r.append("<div class='no-comps'>Couldn't find any related companies for "+s+"</div>")}t.html("");t.append(r)})}var e,t,n,r;var i=this;s(arguments[0]);i.init=function(){n.init();o()}}})();(function(){var e=window;e.data=e.data||{};e.data.$CompanyStore=function(e){function c(e){var n=e.data;var r="success";if(!(n&&n.cmd))return;if(n.cmd==="inittrie"&&n.status==r){o=true}else if(n.cmd==="findmatches"){if(a&&n.status==r){a.resolve({status:r,result:n.result});a=null}if(f.length>0){var i=f.pop();f.length=0;t.findMatches(i)}}}var t=this;var n=25;var r=e;var i,s,o,u;var a;var f=[];var l={};t.init=function(){if(!u){u=true;$.ajax("/companies").done(function(e){if(!s){s=new Worker("js/worker.js");s.addEventListener("message",c,false);s.postMessage({cmd:"inittrie",pckg:{data:e}})}$.each(e,function(){l[this.ticker]=this.name})})}};t.findMatches=function(e){if(o&&!a){s.postMessage({cmd:"findmatches",pckg:{query:e,max:n}});a=$.Deferred()}else{f.push(e)}return a.promise()};t.dispose=function(){_worker.terminate()};t.clearPendingQueries=function(){f.length=0;if(a){a=null}};t.getCompanyName=function(e){return l[e]||""}}})();(function(){var e=window;e.data=e.data||{};e.data.$ComparablesStore=function(){var e=this;e.get=function(e){var t=$.Deferred();$.ajax("/comparables/"+e).done(function(e){t.resolve(e)});return t.promise()}}})()